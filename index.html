<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéì T·∫°o Th·∫ª Sinh Vi√™n - GitHub Pages</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .main-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin: 10px auto;
            padding: 20px;
        }
        .card-header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .student-item {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 10px;
            margin: 5px 0;
            transition: all 0.3s ease;
        }
        .student-item:hover {
            border-color: #667eea;
            background-color: #f8f9fa;
        }
        .student-item input[type="checkbox"] {
            transform: scale(1.2);
            margin-right: 10px;
        }
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            font-weight: 600;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .upload-area {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            background-color: #f8f9fa;
            transition: all 0.3s ease;
        }
        .upload-area:hover {
            border-color: #764ba2;
            background-color: #e9ecef;
        }
        .alert {
            border-radius: 10px;
            border: none;
        }
        .student-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .card-preview {
            max-width: 200px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .canvas-container {
            display: none;
            margin: 10px 0;
        }
        .download-section {
            display: none;
            margin-top: 20px;
        }
        .generated-card {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin: 5px;
            text-align: center;
            background: #f8f9fa;
            min-height: 400px;
        }
        .generated-card img {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-container">
            <!-- Header -->
            <div class="card-header text-center">
                <h1><i class="fas fa-id-card me-2"></i>T·∫°o Th·∫ª Sinh Vi√™n Anh Ver 2</h1>
                <p class="mb-0">
                    <i class="fas fa-robot me-1"></i>University Of London (London)<br>
                    <small class="text-light">
                        <i class="fas fa-check-circle me-1"></i>T·ª± ƒë·ªông tr√°nh tr√πng l·∫∑p |
                        <i class="fas fa-save me-1"></i>L∆∞u l·ªãch s·ª≠ t·∫°o th·∫ª |
                        <i class="fas fa-magic me-1"></i>Ch·ªâ c·∫ßn nh·∫≠p s·ªë l∆∞·ª£ng
                    </small>
                </p>
            </div>

            <!-- Alert Messages -->
            <div id="alertContainer"></div>

            <!-- Upload Template Section -->
            <div class="row mb-3">
                <div class="col-12">
                    <h4><i class="fas fa-upload me-2"></i>Upload Template Th·∫ª</h4>
                    <div class="upload-area" onclick="document.getElementById('templateInput').click()">
                        <i class="fas fa-cloud-upload-alt fa-lg text-primary mb-1"></i>
                        <h6 class="mb-1">K√©o th·∫£ file template v√†o ƒë√¢y ho·∫∑c click ƒë·ªÉ ch·ªçn</h6>
                        <small class="text-muted">H·ªó tr·ª£: PNG, JPG, JPEG</small>
                        <input type="file" id="templateInput" accept=".png,.jpg,.jpeg" style="display: none;">
                        <div id="templatePreview" class="mt-2"></div>
                    </div>
                    
                    <!-- C·∫•u h√¨nh v·ªã tr√≠ text -->
                    <div class="mt-2">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-cog me-2"></i>C·∫•u H√¨nh V·ªã Tr√≠ Text</h6>
                            </div>
                            <div class="card-body py-2">
                                <!-- V·ªã tr√≠ t√™n sinh vi√™n ƒë·∫ßy ƒë·ªß -->
                                <div class="mb-3">
                                    <h6 class="text-primary"><i class="fas fa-user me-2"></i>V·ªã Tr√≠ T√™n Sinh Vi√™n ƒê·∫ßy ƒê·ªß</h6>
                                    <div class="row">
                                        <div class="col-md-3">
                                            <label class="form-label small">T·ª∑ l·ªá ngang (X):</label>
                                            <input type="number" class="form-control form-control-sm" id="fullNameX" value="0.1" step="0.01" min="0" max="1" onchange="updatePosition()">
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label small">T·ª∑ l·ªá d·ªçc (Y):</label>
                                            <input type="number" class="form-control form-control-sm" id="fullNameY" value="0.222" step="0.001" min="0" max="1" onchange="updatePosition()">
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label small">K√≠ch th∆∞·ªõc font:</label>
                                            <input type="number" class="form-control form-control-sm" id="fullNameFontSize" value="130" onchange="updatePosition()">
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label small">M√†u s·∫Øc:</label>
                                            <input type="color" class="form-control form-control-sm" id="fullNameColor" value="#000000" onchange="updatePosition()">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- V·ªã tr√≠ t√™n (First Name) sau Dear -->
                                <div class="mb-3">
                                    <h6 class="text-success"><i class="fas fa-signature me-2"></i>V·ªã Tr√≠ T√™n (First Name) Sau "Dear:"</h6>
                                    <div class="row">
                                        <div class="col-md-3">
                                            <label class="form-label small">T·ª∑ l·ªá ngang (X):</label>
                                            <input type="number" class="form-control form-control-sm" id="lastNameX" value="0.18" step="0.01" min="0" max="1" onchange="updatePosition()">
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label small">T·ª∑ l·ªá d·ªçc (Y):</label>
                                            <input type="number" class="form-control form-control-sm" id="lastNameY" value="0.333" step="0.001" min="0" max="1" onchange="updatePosition()">
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label small">K√≠ch th∆∞·ªõc font:</label>
                                            <input type="number" class="form-control form-control-sm" id="lastNameFontSize" value="130" onchange="updatePosition()">
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label small">M√†u s·∫Øc:</label>
                                            <input type="color" class="form-control form-control-sm" id="lastNameColor" value="#000000" onchange="updatePosition()">
                                        </div>
                                    </div>
                                </div>
                                
                                <small class="text-muted">
                                    <i class="fas fa-info-circle me-1"></i>
                                    S·ª≠ d·ª•ng t·ª∑ l·ªá (0-1) thay v√¨ t·ªça ƒë·ªô tuy·ªát ƒë·ªëi. V√≠ d·ª•: 0.56 = 56% t·ª´ tr√°i sang ph·∫£i
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Student Selection Section -->
            <div class="row">
                <div class="col-12">
                    <h4><i class="fas fa-magic me-2"></i>T·∫°o Th·∫ª T·ª± ƒê·ªông</h4>
                    
                    <!-- Auto Name Generation -->
                    <div class="card">
                        <div class="card-body py-2">
                            <h6 class="card-title"><i class="fas fa-robot me-2"></i>T·ª± ƒê·ªông T·∫°o T√™n Sinh Vi√™n</h6>
                            <label class="form-label small"><i class="fas fa-hashtag me-2"></i>S·ªë l∆∞·ª£ng th·∫ª mu·ªën t·∫°o:</label>
                            <div class="input-group mb-2">
                                <input type="number" class="form-control form-control-sm" id="quantityInput" value="5" min="1" max="100" onchange="updateCount()">
                                <button class="btn btn-outline-secondary btn-sm" type="button" onclick="document.getElementById('quantityInput').value = parseInt(document.getElementById('quantityInput').value) + 5; updateCount();">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <button class="btn btn-outline-secondary btn-sm" type="button" onclick="document.getElementById('quantityInput').value = Math.max(1, parseInt(document.getElementById('quantityInput').value) - 5); updateCount();">
                                    <i class="fas fa-minus"></i>
                                </button>
                            </div>
                            <div class="alert alert-info py-2">
                                <i class="fas fa-robot me-2"></i>
                                <small>Script s·∫Ω t·ª± ƒë·ªông t·∫°o t√™n sinh vi√™n Vi·ªát Nam ng·∫´u nhi√™n, ƒë·∫£m b·∫£o kh√¥ng tr√πng v·ªõi c√°c t√™n ƒë√£ t·∫°o tr∆∞·ªõc ƒë√≥.</small>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <button type="button" class="btn btn-outline-warning btn-sm" onclick="resetUsedStudents()">
                                        <i class="fas fa-undo me-1"></i>Reset danh s√°ch t√™n ƒë√£ t·∫°o
                                    </button>
                                </div>
                                <span class="badge bg-primary" id="selectedCount">5 th·∫ª s·∫Ω ƒë∆∞·ª£c t·∫°o</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center mt-3">
                        <button type="button" class="btn btn-primary btn-lg" id="createBtn" onclick="createCards()" disabled>
                            <i class="fas fa-magic me-2"></i>T·∫°o Th·∫ª Sinh Vi√™n
                        </button>
                    </div>
                </div>
            </div>

            <!-- Generated Cards Section -->
            <div class="download-section" id="downloadSection">
                <h4><i class="fas fa-download me-2"></i>Th·∫ª ƒê√£ T·∫°o</h4>
                <div id="generatedCards" class="row">
                    <!-- Generated cards will be shown here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden Canvas for Image Processing -->
    <canvas id="hiddenCanvas" style="display: none;"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Kh√¥ng c·∫ßn danh s√°ch sinh vi√™n v√¨ s·ª≠ d·ª•ng t√™n t·ª± ƒë·ªông
        const allStudents = [];

        // ============ CAU HINH VI TRI ============
        // S·ª≠ d·ª•ng t·ª∑ l·ªá thay v√¨ t·ªça ƒë·ªô tuy·ªát ƒë·ªëi
        // V·ªã tr√≠ t√™n sinh vi√™n ƒë·∫ßy ƒë·ªß
        const FULL_NAME_X = 0.1;       // left X ratio of the full name area
        const FULL_NAME_Y = 0.222;      // top Y ratio of the full name area
        const FULL_NAME_FONT_SIZE = 130; // Kich thuoc font cho t√™n ƒë·∫ßy ƒë·ªß
        
        // V·ªã tr√≠ h·ªç sinh vi√™n sau "Dear:"
        const LAST_NAME_X = 0.18;      // left X ratio of the last name area (after Dear:)
        const LAST_NAME_Y = 0.333;     // top Y ratio of the last name area
        const LAST_NAME_FONT_SIZE = 130; // Kich thuoc font cho h·ªç

        let templateImage = null;
        let usedStudents = new Set(); // L∆∞u tr·ªØ c√°c t√™n ƒë√£ ƒë∆∞·ª£c ch·ªçn

        // Kh·ªüi t·∫°o giao di·ªán
        function initializeApp() {
            loadUsedStudents();
            setupTemplateUpload();
            updateCount();
            updateStats();
            // Kh·ªüi t·∫°o v·ªã tr√≠ text v·ªõi gi√° tr·ªã m·∫∑c ƒë·ªãnh t·ª´ form
            initializePositionValues();
        }
        
        // Kh·ªüi t·∫°o gi√° tr·ªã v·ªã tr√≠ text t·ª´ form
        function initializePositionValues() {
            // L·∫•y gi√° tr·ªã t·ª´ form ho·∫∑c s·ª≠ d·ª•ng gi√° tr·ªã m·∫∑c ƒë·ªãnh
            const fullNameX = document.getElementById('fullNameX')?.value || '0.1';
            const fullNameY = document.getElementById('fullNameY')?.value || '0.215';
            const fullNameFontSize = document.getElementById('fullNameFontSize')?.value || '130';
            const fullNameColor = document.getElementById('fullNameColor')?.value || '#000000';
            
            const lastNameX = document.getElementById('lastNameX')?.value || '0.18';
            const lastNameY = document.getElementById('lastNameY')?.value || '0.333';
            const lastNameFontSize = document.getElementById('lastNameFontSize')?.value || '130';
            const lastNameColor = document.getElementById('lastNameColor')?.value || '#000000';
            
            // Kh·ªüi t·∫°o c√°c bi·∫øn window
            window.FULL_NAME_X = parseFloat(fullNameX);
            window.FULL_NAME_Y = parseFloat(fullNameY);
            window.FULL_NAME_FONT_SIZE = parseInt(fullNameFontSize);
            window.FULL_NAME_COLOR = fullNameColor;
            
            window.LAST_NAME_X = parseFloat(lastNameX);
            window.LAST_NAME_Y = parseFloat(lastNameY);
            window.LAST_NAME_FONT_SIZE = parseInt(lastNameFontSize);
            window.LAST_NAME_COLOR = lastNameColor;
        }

        // Load danh s√°ch sinh vi√™n ƒë√£ s·ª≠ d·ª•ng t·ª´ localStorage
        function loadUsedStudents() {
            const saved = localStorage.getItem('usedStudents');
            if (saved) {
                usedStudents = new Set(JSON.parse(saved));
            }
        }

        // L∆∞u danh s√°ch sinh vi√™n ƒë√£ s·ª≠ d·ª•ng v√†o localStorage
        function saveUsedStudents() {
            localStorage.setItem('usedStudents', JSON.stringify([...usedStudents]));
        }


        // Setup template upload
        function setupTemplateUpload() {
            const input = document.getElementById('templateInput');
            input.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        templateImage = new Image();
                        templateImage.onload = function() {
                            showTemplatePreview();
                        };
                        templateImage.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // Hi·ªÉn th·ªã preview template
        function showTemplatePreview() {
            const preview = document.getElementById('templatePreview');
            preview.innerHTML = `
                <div class="text-center">
                    <img src="${templateImage.src}" class="card-preview" alt="Template Preview" style="max-height: 100px;">
                    <p class="text-success mt-1 mb-1"><i class="fas fa-check-circle me-1"></i>Template ƒë√£ ƒë∆∞·ª£c t·∫£i th√†nh c√¥ng!</p>
                    <button class="btn btn-outline-primary btn-sm" onclick="downloadTemplate()">
                        <i class="fas fa-download me-1"></i>T·∫£i Template
                    </button>
                </div>
            `;
        }

        // T·∫£i template hi·ªán t·∫°i
        function downloadTemplate() {
            if (templateImage) {
                const link = document.createElement('a');
                link.download = 'template.png';
                link.href = templateImage.src;
                link.click();
            }
        }

        // C·∫≠p nh·∫≠t v·ªã tr√≠ text
        function updatePosition() {
            // C·∫≠p nh·∫≠t v·ªã tr√≠ t√™n ƒë·∫ßy ƒë·ªß
            const fullNameX = document.getElementById('fullNameX').value;
            const fullNameY = document.getElementById('fullNameY').value;
            const fullNameFontSize = document.getElementById('fullNameFontSize').value;
            const fullNameColor = document.getElementById('fullNameColor').value;
            
            // C·∫≠p nh·∫≠t v·ªã tr√≠ h·ªç sinh vi√™n
            const lastNameX = document.getElementById('lastNameX').value;
            const lastNameY = document.getElementById('lastNameY').value;
            const lastNameFontSize = document.getElementById('lastNameFontSize').value;
            const lastNameColor = document.getElementById('lastNameColor').value;
            
            // C·∫≠p nh·∫≠t c√°c h·∫±ng s·ªë
            window.FULL_NAME_X = parseFloat(fullNameX);
            window.FULL_NAME_Y = parseFloat(fullNameY);
            window.FULL_NAME_FONT_SIZE = parseInt(fullNameFontSize);
            window.FULL_NAME_COLOR = fullNameColor;
            
            window.LAST_NAME_X = parseFloat(lastNameX);
            window.LAST_NAME_Y = parseFloat(lastNameY);
            window.LAST_NAME_FONT_SIZE = parseInt(lastNameFontSize);
            window.LAST_NAME_COLOR = lastNameColor;
            
            showAlert(`ƒê√£ c·∫≠p nh·∫≠t v·ªã tr√≠: T√™n ƒë·∫ßy ƒë·ªß (${fullNameX}, ${fullNameY}, ${fullNameFontSize}px) | H·ªç (${lastNameX}, ${lastNameY}, ${lastNameFontSize}px)`, 'info');
        }

        // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng th·∫ª s·∫Ω ƒë∆∞·ª£c t·∫°o
        function updateCount() {
            const quantity = parseInt(document.getElementById('quantityInput').value) || 0;
            document.getElementById('selectedCount').textContent = quantity + ' th·∫ª s·∫Ω ƒë∆∞·ª£c t·∫°o';
            document.getElementById('createBtn').disabled = quantity === 0 || !templateImage;
        }

        // C·∫≠p nh·∫≠t th·ªëng k√™
        function updateStats() {
            const usedCount = usedStudents.size;
            const quantity = parseInt(document.getElementById('quantityInput').value) || 0;
            
            // C·∫≠p nh·∫≠t badge hi·ªÉn th·ªã s·ªë t√™n ƒë√£ t·∫°o
            const badge = document.getElementById('selectedCount');
            badge.textContent = `${quantity} th·∫ª s·∫Ω ƒë∆∞·ª£c t·∫°o | ƒê√£ t·∫°o: ${usedCount} t√™n`;
        }


        // Reset danh s√°ch sinh vi√™n ƒë√£ s·ª≠ d·ª•ng
        function resetUsedStudents() {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën reset danh s√°ch t√™n ƒë√£ t·∫°o? T·∫•t c·∫£ t√™n s·∫Ω c√≥ th·ªÉ ƒë∆∞·ª£c t·∫°o l·∫°i.')) {
                usedStudents.clear();
                saveUsedStudents();
                updateStats();
                showAlert('ƒê√£ reset danh s√°ch t√™n ƒë√£ t·∫°o!', 'success');
            }
        }

        // T·∫°o t√™n sinh vi√™n ti·∫øng Anh ng·∫´u nhi√™n
        function generateRandomName() {
            const familyNames = ["Smith","Johnson","Williams","Brown","Jones","Garcia","Miller","Davis",
                "Rodriguez","Martinez","Hernandez","Lopez","Gonzalez","Wilson","Anderson","Thomas","Taylor",
                "Moore","Jackson","Martin","Lee","Perez","Thompson","White","Harris","Sanchez","Clark",
                "Ramirez","Lewis","Robinson","Walker","Young","Allen","King","Wright","Scott","Torres",
                "Nguyen","Hill","Flores","Green","Adams","Nelson","Baker","Hall","Rivera","Campbell"];
            
            const givenNames = ["Alexander","Benjamin","Christopher","Daniel","Ethan","Gabriel","Henry",
                "Isaac","Jacob","Kevin","Liam","Michael","Nathan","Oliver","Patrick","Quinn","Ryan",
                "Samuel","Thomas","Victor","William","Zachary","Aaron","Brandon","Caleb","David",
                "Elijah","Felix","George","Hunter","Ian","Jack","Kyle","Luke","Matthew","Nicholas",
                "Owen","Paul","Robert","Sebastian","Tyler","Vincent","Wyatt","Adam","Blake","Carter",
                "Dylan","Evan","Finn","Grayson","Hayden","Isaac","Jaxon","Kai","Lucas","Mason","Noah",
                "Oscar","Parker","Quentin","Riley","Sawyer","Tristan","Uriel","Vaughn","Wesley","Xavier",
                "Yusuf","Zane","Amelia","Bella","Charlotte","Delilah","Emma","Faith","Grace","Hannah",
                "Isabella","Julia","Katherine","Lily","Madison","Natalie","Olivia","Penelope","Quinn",
                "Ruby","Sophia","Taylor","Uma","Victoria","Willow","Ximena","Yara","Zoe","Abigail",
                "Brooklyn","Chloe","Diana","Elena","Fiona","Gabriella","Harper","Iris","Jasmine","Kinsley",
                "Luna","Maya","Nora","Ophelia","Piper","Quinn","Rose","Stella","Tessa","Una","Violet",
                "Wren","Xara","Yolanda","Zara","Aria","Brielle","Cora","Daisy","Eva","Freya","Gianna",
                "Hazel","Ivy","Jade","Kira","Layla","Mia","Nova","Oakley","Paisley","Quinn","Raya",
                "Sage","Talia","Uma","Vera","Willa","Xara","Yara","Zara"];
            
            const firstName = givenNames[Math.floor(Math.random() * givenNames.length)];
            const lastName = familyNames[Math.floor(Math.random() * familyNames.length)];
            
            return `${firstName} ${lastName}`;
        }

        // T·∫°o th·∫ª sinh vi√™n
        function createCards() {
            if (!templateImage) {
                showAlert('Vui l√≤ng upload template tr∆∞·ªõc!', 'warning');
                return;
            }

            // T·∫°o t√™n ng·∫´u nhi√™n t·ª± ƒë·ªông
            const quantity = parseInt(document.getElementById('quantityInput').value) || 0;
            if (quantity === 0) {
                showAlert('Vui l√≤ng nh·∫≠p s·ªë l∆∞·ª£ng th·∫ª mu·ªën t·∫°o!', 'warning');
                return;
            }
            
            // T·∫°o t√™n ng·∫´u nhi√™n kh√¥ng tr√πng
            const selectedStudents = [];
            const attempts = quantity * 10;
            
            for (let i = 0; i < attempts && selectedStudents.length < quantity; i++) {
                const name = generateRandomName();
                if (!usedStudents.has(name) && !selectedStudents.includes(name)) {
                    selectedStudents.push(name);
                }
            }
            
            if (selectedStudents.length < quantity) {
                showAlert(`Ch·ªâ c√≥ th·ªÉ t·∫°o ${selectedStudents.length}/${quantity} t√™n kh√¥ng tr√πng. Vui l√≤ng th·ª≠ l·∫°i ho·∫∑c gi·∫£m s·ªë l∆∞·ª£ng.`, 'warning');
            }

            showAlert(`ƒêang t·∫°o ${selectedStudents.length} th·∫ª...`, 'info');
            
            // T·∫°o th·∫ª cho t·ª´ng sinh vi√™n
            const generatedCards = [];
            selectedStudents.forEach(studentName => {
                const cardData = createStudentCard(studentName);
                if (cardData) {
                    generatedCards.push({
                        name: studentName,
                        dataUrl: cardData
                    });
                    
                    // ƒê√°nh d·∫•u sinh vi√™n ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng
                    usedStudents.add(studentName);
                }
            });

            if (generatedCards.length > 0) {
                // L∆∞u danh s√°ch sinh vi√™n ƒë√£ s·ª≠ d·ª•ng
                saveUsedStudents();
                
                // C·∫≠p nh·∫≠t giao di·ªán
                updateStats();
                
                showGeneratedCards(generatedCards);
                showAlert(`ƒê√£ t·∫°o th√†nh c√¥ng ${generatedCards.length} th·∫ª sinh vi√™n!`, 'success');
            } else {
                showAlert('Kh√¥ng th·ªÉ t·∫°o th·∫ª. Vui l√≤ng ki·ªÉm tra template.', 'danger');
            }
        }

        // T·∫°o th·∫ª cho m·ªôt sinh vi√™n
        function createStudentCard(studentName) {
            try {
                const canvas = document.getElementById('hiddenCanvas');
                const ctx = canvas.getContext('2d');
                
                // Set canvas size to match template
                canvas.width = templateImage.width;
                canvas.height = templateImage.height;
                
                // Draw template
                ctx.drawImage(templateImage, 0, 0);
                
                // T√°ch t√™n v√† h·ªç
                const nameParts = studentName.trim().split(' ');
                const lastName = nameParts[nameParts.length - 1];
                const firstName = nameParts.slice(0, -1).join(' '); // T·∫•t c·∫£ t·ª´ tr∆∞·ªõc t·ª´ cu·ªëi c√πng
                const fullName = studentName;
                
                // V·∫Ω t√™n ƒë·∫ßy ƒë·ªß
                const fullNameFontSize = window.FULL_NAME_FONT_SIZE || FULL_NAME_FONT_SIZE;
                const fullNameColor = window.FULL_NAME_COLOR || '#000000';
                ctx.font = `bold ${fullNameFontSize}px Arial`;
                ctx.fillStyle = fullNameColor;
                ctx.textAlign = 'left';
                ctx.textBaseline = 'top';
                
                const fullNameX = canvas.width * (window.FULL_NAME_X || FULL_NAME_X);
                const fullNameY = canvas.height * (window.FULL_NAME_Y || FULL_NAME_Y);
                ctx.fillText(fullName, fullNameX, fullNameY);
                
                // V·∫Ω ch·ªâ t√™n (First Name) sau "Dear:"
                const dearNameFontSize = window.LAST_NAME_FONT_SIZE || LAST_NAME_FONT_SIZE;
                const dearNameColor = window.LAST_NAME_COLOR || '#000000';
                ctx.font = `bold ${dearNameFontSize}px Arial`;
                ctx.fillStyle = dearNameColor;
                ctx.textAlign = 'left';
                ctx.textBaseline = 'top';
                
                const dearNameX = canvas.width * (window.LAST_NAME_X || LAST_NAME_X);
                const dearNameY = canvas.height * (window.LAST_NAME_Y || LAST_NAME_Y);
                ctx.fillText(firstName, dearNameX, dearNameY); // S·ª≠ d·ª•ng firstName
                
                return canvas.toDataURL('image/png');
            } catch (error) {
                console.error('Error creating card:', error);
                return null;
            }
        }

        // Hi·ªÉn th·ªã th·∫ª ƒë√£ t·∫°o
        function showGeneratedCards(cards) {
            const container = document.getElementById('generatedCards');
            const section = document.getElementById('downloadSection');
            
            container.innerHTML = cards.map(card => `
                <div class="col-md-6 col-lg-4 mb-3">
                    <div class="generated-card">
                        <img src="${card.dataUrl}" alt="${card.name}" class="mb-2" style="max-height: 250px; width: auto;">
                        <h6 class="mb-2">${card.name}</h6>
                        <div class="btn-group-vertical w-100" role="group">
                            <button class="btn btn-outline-primary btn-sm mb-1" onclick="downloadCard('${card.dataUrl}', '${card.name}')">
                                <i class="fas fa-download me-1"></i>Download
                            </button>
                            <button class="btn btn-outline-success btn-sm mb-1" onclick="copySchoolName('${card.name}')">
                                <i class="fas fa-copy me-1"></i>Copy T√™n Tr∆∞·ªùng
                            </button>
                            <button class="btn btn-outline-warning btn-sm" onclick="generateFormScript('${card.name}')">
                                <i class="fas fa-code me-1"></i>Script Form
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            section.style.display = 'block';
        }

        // Download th·∫ª
        function downloadCard(dataUrl, name) {
            const link = document.createElement('a');
            link.download = `card_${name.replace(/\s+/g, '_')}.png`;
            link.href = dataUrl;
            link.click();
        }

        // Copy t√™n tr∆∞·ªùng ƒë·∫°i h·ªçc tr·ª±c ti·∫øp
        function copySchoolName(studentName) {
            const schoolName = "University Of London (London)";
            
            // Copy tr·ª±c ti·∫øp v√†o clipboard
            navigator.clipboard.writeText(schoolName).then(() => {
                showCopySuccessPopup('University Name', schoolName);
            }).catch(() => {
                // Fallback cho tr√¨nh duy·ªát c≈©
                const textArea = document.createElement('textarea');
                textArea.value = schoolName;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showCopySuccessPopup('University Name', schoolName);
            });
        }

        // Copy script form t·ª± ƒë·ªông ƒëi·ªÅn tr·ª±c ti·∫øp
        function generateFormScript(studentName) {
            // T√°ch h·ªç v√† t√™n
            const nameParts = studentName.trim().split(' ');
            const lastName = nameParts[nameParts.length - 1];
            const firstName = nameParts.slice(0, -1).join(' ');
            
            // T·∫°o email t·ª´ t√™n ti·∫øng Anh
            const email = `${studentName.toLowerCase()
                .replace(/\s+/g, '')
                .replace(/[^a-z0-9]/g, '')}@london.ac.uk`;
            
            // T·∫°o script
            const script = `// Script t·ª± ƒë·ªông ƒëi·ªÅn form cho ${studentName}
(async () => {
    const delay = ms => new Promise(r => setTimeout(r, ms));
    const set = async (sel, val) => {
        const el = document.querySelector(sel);
        if (!el) return;
        const setVal = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, "value").set;
        setVal.call(el, val);
        el.dispatchEvent(new Event("input", { bubbles: true }));
        el.dispatchEvent(new Event("change", { bubbles: true }));
        el.dispatchEvent(new Event("blur", { bubbles: true }));
        await delay(150);
    };
    
    const pasteSchool = async (schoolName) => {
        console.log("üè´ B·∫Øt ƒë·∫ßu ch·ªçn tr∆∞·ªùng ƒë·∫°i h·ªçc...");
        
        // T√¨m tr∆∞·ªùng ƒë·∫°i h·ªçc v·ªõi nhi·ªÅu selector kh√°c nhau
        const schoolSelectors = [
            'input[placeholder*="T√™n ƒê·∫°i h·ªçc"]',
            'input[placeholder*="University"]',
            'input[placeholder*="College"]',
            'input[name*="university"]',
            'input[name*="school"]',
            '#university',
            '#school',
            '.university-select',
            '.school-select',
            '[data-testid*="university"]',
            '[data-testid*="school"]'
        ];
        
        let schoolEl = null;
        for (const selector of schoolSelectors) {
            schoolEl = document.querySelector(selector);
            if (schoolEl) {
                console.log(\`‚úÖ T√¨m th·∫•y tr∆∞·ªùng ƒë·∫°i h·ªçc v·ªõi selector: \${selector}\`);
                break;
            }
        }
        
        if (!schoolEl) {
            console.log("‚ùå Kh√¥ng t√¨m th·∫•y tr∆∞·ªùng ƒë·∫°i h·ªçc");
            return;
        }
        
        console.log("üîç Tr∆∞·ªùng ƒë·∫°i h·ªçc:", schoolEl);
        
        // Click v√†o dropdown ƒë·ªÉ m·ªü danh s√°ch
        schoolEl.focus();
        schoolEl.click();
        console.log("üñ±Ô∏è ƒê√£ click v√†o dropdown tr∆∞·ªùng ƒë·∫°i h·ªçc");
        await delay(2000);
        
        // T√¨m dropdown container
        const dropdownSelectors = [
            '[role="listbox"]',
            '.dropdown-menu',
            '.select-dropdown',
            '.ant-select-dropdown',
            '.rc-select-dropdown',
            '.el-select-dropdown',
            '[class*="dropdown"]',
            '[class*="menu"]',
            '[class*="select"]'
        ];
        
        let dropdownContainer = null;
        for (const selector of dropdownSelectors) {
            dropdownContainer = document.querySelector(selector);
            if (dropdownContainer) {
                console.log(\`‚úÖ T√¨m th·∫•y dropdown container v·ªõi selector: \${selector}\`);
                break;
            }
        }
        
        if (!dropdownContainer) {
            console.log("‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y dropdown container, th·ª≠ t√¨m options tr·ª±c ti·∫øp");
        }
        
        // T√¨m t·∫•t c·∫£ options trong dropdown
        const optionSelectors = [
            '[role="option"]',
            '.option',
            'li[data-value]',
            'div[data-value]',
            '.dropdown-item',
            '.select-option',
            '.menu-item',
            '.list-item',
            'li',
            'div[class*="option"]',
            'div[class*="item"]'
        ];
        
        let options = [];
        for (const selector of optionSelectors) {
            options = [...document.querySelectorAll(selector)];
            if (options.length > 0) {
                console.log(\`‚úÖ T√¨m th·∫•y \${options.length} options v·ªõi selector: \${selector}\`);
                break;
            }
        }
        
        // Debug: Hi·ªÉn th·ªã t·∫•t c·∫£ options
        console.log("üîç T·∫•t c·∫£ options c√≥ s·∫µn:");
        options.forEach((option, index) => {
            const text = option.innerText || option.textContent || '';
            console.log(\`  \${index + 1}. "\${text}"\`);
        });
        
        // T√¨m option Tay Nguyen University v·ªõi nhi·ªÅu t√™n kh√°c nhau
        let targetOption = options.find(o => {
            const text = o.innerText || o.textContent || '';
            const lowerText = text.toLowerCase();
            return lowerText.includes('tay nguyen university') ||
                   lowerText.includes('university of tay nguyen') ||
                   lowerText.includes('ttn') ||
                   lowerText.includes('tay nguyen university (dak lak)') ||
                   lowerText.includes('tay nguyen university (dak lak, vietnam)') ||
                   lowerText.includes('tay nguyen university dak lak') ||
                   lowerText.includes('tay nguyen university vietnam');
        });
        
        if (targetOption) {
            const selectedText = targetOption.innerText || targetOption.textContent || '';
            console.log(\`‚úÖ T√¨m th·∫•y option: "\${selectedText}"\`);
            
            // Scroll v√†o view v√† click
            targetOption.scrollIntoView({ behavior: 'smooth', block: 'center' });
            await delay(500);
            targetOption.click();
            console.log(\`‚úÖ ƒê√£ click v√†o: "\${selectedText}"\`);
            
        } else {
            console.log("‚ùå Kh√¥ng t√¨m th·∫•y Tay Nguyen University trong options, th·ª≠ cu·ªôn v√† t√¨m...");
            
            // Cu·ªôn trong dropdown ƒë·ªÉ t√¨m tr∆∞·ªùng
            if (dropdownContainer) {
                console.log("üîÑ Cu·ªôn trong dropdown container...");
                
                // Cu·ªôn xu·ªëng ƒë·ªÉ t√¨m tr∆∞·ªùng
                for (let i = 0; i < 20; i++) {
                    dropdownContainer.scrollTop += 100;
                    await delay(300);
                    
                    // T√¨m l·∫°i options sau khi cu·ªôn
                    const newOptions = [...document.querySelectorAll('[role="option"], .option, li, div[class*="option"]')];
                    
                    targetOption = newOptions.find(o => {
                        const text = o.innerText || o.textContent || '';
                        const lowerText = text.toLowerCase();
                        return lowerText.includes('tay nguyen university') ||
                               lowerText.includes('university of tay nguyen') ||
                               lowerText.includes('ttn') ||
                               lowerText.includes('tay nguyen university (dak lak)') ||
                               lowerText.includes('tay nguyen university (dak lak, vietnam)');
                    });
                    
                    if (targetOption) {
                        const selectedText = targetOption.innerText || targetOption.textContent || '';
                        console.log(\`‚úÖ T√¨m th·∫•y sau khi cu·ªôn: "\${selectedText}"\`);
                        targetOption.click();
                        console.log(\`‚úÖ ƒê√£ click v√†o: "\${selectedText}"\`);
                        break;
                    }
                }
            }
            
            // N·∫øu v·∫´n kh√¥ng t√¨m th·∫•y, th·ª≠ t√¨m t·∫•t c·∫£ elements
            if (!targetOption) {
                console.log("üîç T√¨m t·∫•t c·∫£ elements c√≥ ch·ª©a Tay Nguyen University...");
                const allElements = document.querySelectorAll('*');
                const schoolElements = Array.from(allElements).filter(el => {
                    const text = el.innerText || el.textContent || '';
                    return text.toLowerCase().includes('tay nguyen university') ||
                           text.toLowerCase().includes('university of tay nguyen') ||
                           text.toLowerCase().includes('ttn') ||
                           text.toLowerCase().includes('tay nguyen university (dak lak)');
                });
                
                console.log(\`üîç T√¨m th·∫•y \${schoolElements.length} elements c√≥ ch·ª©a TTN:\`);
                schoolElements.forEach((el, i) => {
                    console.log(\`  \${i + 1}. \${el.tagName}: "\${el.innerText || el.textContent}"\`);
                });
                
                if (schoolElements.length > 0) {
                    console.log("üñ±Ô∏è Click v√†o element ƒë·∫ßu ti√™n...");
                    schoolElements[0].click();
                } else {
                    console.log("‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y Tay Nguyen University, th·ª≠ nh·∫≠p th·ªß c√¥ng...");
                    
                    // Th·ª≠ nh·∫≠p th·ªß c√¥ng v√†o tr∆∞·ªùng ƒë·∫°i h·ªçc
                    const schoolInput = document.querySelector('input[placeholder*="T√™n ƒê·∫°i h·ªçc"], input[placeholder*="University"], input[placeholder*="College"]');
                    if (schoolInput) {
                        console.log("üìù Nh·∫≠p th·ªß c√¥ng t√™n tr∆∞·ªùng...");
                        schoolInput.focus();
                        schoolInput.value = '';
                        schoolInput.value = 'Tay Nguyen University (Dak Lak, Vietnam)';
                        schoolInput.dispatchEvent(new Event('input', { bubbles: true }));
                        schoolInput.dispatchEvent(new Event('change', { bubbles: true }));
                        await delay(1000);
                        
                        // Ki·ªÉm tra xem c√≥ b·ªã ƒëi·ªÅn nh·∫ßm t√™n sinh vi√™n kh√¥ng
                        if (schoolInput.value.includes('${studentName}') || schoolInput.value.includes('${firstName}') || schoolInput.value.includes('${lastName}')) {
                            console.log("‚ö†Ô∏è Ph√°t hi·ªán t√™n sinh vi√™n b·ªã ƒëi·ªÅn nh·∫ßm v√†o tr∆∞·ªùng ƒë·∫°i h·ªçc!");
                            console.log("üîÑ X√≥a v√† ƒëi·ªÅn l·∫°i t√™n tr∆∞·ªùng...");
                            schoolInput.value = '';
                            schoolInput.value = 'Tay Nguyen University (Dak Lak, Vietnam)';
                            schoolInput.dispatchEvent(new Event('input', { bubbles: true }));
                            schoolInput.dispatchEvent(new Event('change', { bubbles: true }));
                            await delay(1000);
                        }
                    }
                }
            }
        }
        
        await delay(1000);
        console.log("üìù Gi√° tr·ªã cu·ªëi c√πng:", schoolEl.value);
        console.log("‚úÖ Ho√†n th√†nh ch·ªçn tr∆∞·ªùng ƒë·∫°i h·ªçc");
    };
    
    const selectCountry = async (countryName) => {
        console.log("üöÄ B·∫Øt ƒë·∫ßu ch·ªçn qu·ªëc gia...");
        
        // T√¨m tr∆∞·ªùng qu·ªëc gia v·ªõi nhi·ªÅu selector kh√°c nhau
        const countrySelectors = [
            'input[placeholder*="Qu·ªëc gia"]',
            'input[placeholder*="Country"]', 
            'select[name*="country"]',
            'input[name*="country"]',
            '#country',
            '.country-select',
            '[data-testid*="country"]'
        ];
        
        let countryEl = null;
        for (const selector of countrySelectors) {
            countryEl = document.querySelector(selector);
            if (countryEl) {
                console.log(\`‚úÖ T√¨m th·∫•y tr∆∞·ªùng qu·ªëc gia v·ªõi selector: \${selector}\`);
                break;
            }
        }
        
        if (!countryEl) {
            console.log("‚ùå Kh√¥ng t√¨m th·∫•y tr∆∞·ªùng Qu·ªëc gia");
            return;
        }
        
        console.log("üîç Tr∆∞·ªùng qu·ªëc gia:", countryEl);
        console.log("üìù Gi√° tr·ªã hi·ªán t·∫°i:", countryEl.value);
        
        // Click v√†o dropdown ƒë·ªÉ m·ªü danh s√°ch
        countryEl.focus();
        countryEl.click();
        console.log("üñ±Ô∏è ƒê√£ click v√†o dropdown qu·ªëc gia");
        await delay(2000);
        
        // T√¨m dropdown container
        const dropdownSelectors = [
            '[role="listbox"]',
            '.dropdown-menu',
            '.select-dropdown',
            '.ant-select-dropdown',
            '.rc-select-dropdown',
            '.el-select-dropdown',
            '[class*="dropdown"]',
            '[class*="menu"]',
            '[class*="select"]'
        ];
        
        let dropdownContainer = null;
        for (const selector of dropdownSelectors) {
            dropdownContainer = document.querySelector(selector);
            if (dropdownContainer) {
                console.log(\`‚úÖ T√¨m th·∫•y dropdown container v·ªõi selector: \${selector}\`);
                break;
            }
        }
        
        if (!dropdownContainer) {
            console.log("‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y dropdown container, th·ª≠ t√¨m options tr·ª±c ti·∫øp");
        }
        
        // T√¨m t·∫•t c·∫£ options trong dropdown
        const optionSelectors = [
            '[role="option"]',
            '.option',
            'li[data-value]',
            'div[data-value]',
            '.dropdown-item',
            '.select-option',
            '.menu-item',
            '.list-item',
            'li',
            'div[class*="option"]',
            'div[class*="item"]'
        ];
        
        let options = [];
        for (const selector of optionSelectors) {
            options = [...document.querySelectorAll(selector)];
            if (options.length > 0) {
                console.log(\`‚úÖ T√¨m th·∫•y \${options.length} options v·ªõi selector: \${selector}\`);
                break;
            }
        }
        
        // Debug: Hi·ªÉn th·ªã t·∫•t c·∫£ options
        console.log("üîç T·∫•t c·∫£ options c√≥ s·∫µn:");
        options.forEach((option, index) => {
            const text = option.innerText || option.textContent || '';
            console.log(\`  \${index + 1}. "\${text}"\`);
        });
        
        // T√¨m option Vietnam
        let targetOption = options.find(o => {
            const text = o.innerText || o.textContent || '';
            const lowerText = text.toLowerCase();
            return lowerText === 'vietnam' ||
                   lowerText.includes('vietnam') ||
                   lowerText.includes('viet nam') ||
                   lowerText.includes('vi·ªát nam');
        });
        
        if (targetOption) {
            const selectedText = targetOption.innerText || targetOption.textContent || '';
            console.log(\`‚úÖ T√¨m th·∫•y option: "\${selectedText}"\`);
            
            // Scroll v√†o view v√† click
            targetOption.scrollIntoView({ behavior: 'smooth', block: 'center' });
            await delay(500);
            targetOption.click();
            console.log(\`‚úÖ ƒê√£ click v√†o: "\${selectedText}"\`);
            
        } else {
            console.log("‚ùå Kh√¥ng t√¨m th·∫•y Vietnam trong options, th·ª≠ cu·ªôn v√† t√¨m...");
            
            // Cu·ªôn trong dropdown ƒë·ªÉ t√¨m Vietnam
            if (dropdownContainer) {
                console.log("üîÑ Cu·ªôn trong dropdown container...");
                
                // Cu·ªôn xu·ªëng ƒë·ªÉ t√¨m Vietnam
                for (let i = 0; i < 10; i++) {
                    dropdownContainer.scrollTop += 100;
                    await delay(300);
                    
                    // T√¨m l·∫°i options sau khi cu·ªôn
                    const newOptions = [...document.querySelectorAll('[role="option"], .option, li, div[class*="option"]')];
                    
                    targetOption = newOptions.find(o => {
                        const text = o.innerText || o.textContent || '';
                        const lowerText = text.toLowerCase();
                        return lowerText.includes('vietnam') ||
                               lowerText.includes('viet nam') ||
                               lowerText.includes('vi·ªát nam');
                    });
                    
                    if (targetOption) {
                        const selectedText = targetOption.innerText || targetOption.textContent || '';
                        console.log(\`‚úÖ T√¨m th·∫•y sau khi cu·ªôn: "\${selectedText}"\`);
                        targetOption.click();
                        console.log(\`‚úÖ ƒê√£ click v√†o: "\${selectedText}"\`);
                        break;
                    }
                }
            }
        }
        
        await delay(1000);
        console.log("üìù Gi√° tr·ªã cu·ªëi c√πng:", countryEl.value);
        console.log("‚úÖ Ho√†n th√†nh ch·ªçn qu·ªëc gia");
    };
    
    const selectMonth = async () => {
        const el = document.querySelector('#sid-birthdate__month');
        if (!el) return;
        el.focus();
        el.click();
        await delay(500);
        
        // T√¨m v√† ch·ªçn th√°ng 3 v·ªõi nhi·ªÅu t√πy ch·ªçn
        const monthOptions = [...document.querySelectorAll('#sid-birthdate__month-menu [role="option"]')];
        const marchOption = monthOptions.find(o => 
            o.innerText.includes("Th√°ng 3") || 
            o.innerText.toLowerCase().includes("th√°ng 3") || 
            o.innerText.toLowerCase().includes("th√°ng ba") || 
            o.innerText.toLowerCase().includes("march") ||
            o.innerText.toLowerCase().startsWith("mar") ||
            o.innerText.includes("3") ||
            o.innerText.includes("03")
        );
        
        if (marchOption) {
            marchOption.click();
            console.log("‚úÖ ƒê√£ ch·ªçn Th√°ng 3");
        } else {
            console.log("‚ùå Kh√¥ng t√¨m th·∫•y Th√°ng 3 trong dropdown");
        }
        await delay(300);
    };
    
    // B·ªè qua vi·ªác ch·ªçn qu·ªëc gia v√† tr∆∞·ªùng ƒë·∫°i h·ªçc
    // await selectCountry("Vietnam");
    // await delay(2000); // ƒê·ª£i dropdown qu·ªëc gia load xong
    // await pasteSchool("Tay Nguyen University (Dak Lak, Vietnam)");
    await selectMonth();
    
    // ƒêi·ªÅn th√¥ng tin c√° nh√¢n v·ªõi nhi·ªÅu selector kh√°c nhau
    const fillPersonalInfo = async () => {
        console.log("üë§ B·∫Øt ƒë·∫ßu ƒëi·ªÅn th√¥ng tin c√° nh√¢n...");
        
        // T√™n - Tr√°nh ƒëi·ªÅn nh·∫ßm v√†o tr∆∞·ªùng ƒë·∫°i h·ªçc
        const firstNameSelectors = [
            'input[placeholder*="T√™n"]:not([placeholder*="ƒê·∫°i h·ªçc"]):not([placeholder*="University"]):not([placeholder*="College"])',
            'input[name*="first"]:not([name*="university"]):not([name*="school"])',
            'input[name*="given"]:not([name*="university"]):not([name*="school"])',
            '#first-name:not([id*="university"]):not([id*="school"])',
            '#given-name:not([id*="university"]):not([id*="school"])'
        ];
        
        for (const selector of firstNameSelectors) {
            const el = document.querySelector(selector);
            if (el && !el.value && !el.placeholder?.includes('ƒê·∫°i h·ªçc') && !el.placeholder?.includes('University') && !el.placeholder?.includes('College')) {
                await set(selector, '${firstName}');
                console.log(\`‚úÖ ƒê√£ ƒëi·ªÅn t√™n v·ªõi selector: \${selector}\`);
                break;
            }
        }
        
        // H·ªç
        const lastNameSelectors = [
            'input[placeholder*="H·ªç"]',
            'input[name*="last"]',
            'input[name*="family"]',
            '#last-name',
            '#family-name',
            'input[type="text"]:nth-of-type(2)'
        ];
        
        for (const selector of lastNameSelectors) {
            const el = document.querySelector(selector);
            if (el && !el.value) {
                await set(selector, '${lastName}');
                console.log(\`‚úÖ ƒê√£ ƒëi·ªÅn h·ªç v·ªõi selector: \${selector}\`);
                break;
            }
        }
        
        // Ng√†y sinh
        const daySelectors = [
            'input[placeholder*="N..."]',
            'input[placeholder*="Ng√†y"]',
            'input[name*="day"]',
            '#day',
            'input[type="number"]:nth-of-type(1)'
        ];
        
        for (const selector of daySelectors) {
            const el = document.querySelector(selector);
            if (el && !el.value) {
                await set(selector, '26');
                console.log(\`‚úÖ ƒê√£ ƒëi·ªÅn ng√†y v·ªõi selector: \${selector}\`);
                break;
            }
        }
        
        // NƒÉm sinh
        const yearSelectors = [
            'input[placeholder*="NƒÉm"]',
            'input[name*="year"]',
            '#year',
            'input[type="number"]:nth-of-type(2)'
        ];
        
        for (const selector of yearSelectors) {
            const el = document.querySelector(selector);
            if (el && !el.value) {
                await set(selector, '2006');
                console.log(\`‚úÖ ƒê√£ ƒëi·ªÅn nƒÉm v·ªõi selector: \${selector}\`);
                break;
            }
        }
        
        // Email
        const emailSelectors = [
            'input[placeholder*="email"]',
            'input[type="email"]',
            'input[name*="email"]',
            '#email',
            'input[placeholder*="ƒê·ªãa ch·ªâ email"]'
        ];
        
        for (const selector of emailSelectors) {
            const el = document.querySelector(selector);
            if (el && !el.value) {
                await set(selector, '${email}');
                console.log(\`‚úÖ ƒê√£ ƒëi·ªÅn email v·ªõi selector: \${selector}\`);
                break;
            }
        }
    };
    
    // ƒêi·ªÅn th√¥ng tin c√° nh√¢n
    await fillPersonalInfo();
    
    // Ki·ªÉm tra v√† s·ª≠a l·ªói ƒëi·ªÅn nh·∫ßm t√™n sinh vi√™n v√†o tr∆∞·ªùng ƒë·∫°i h·ªçc
    await delay(1000);
    console.log("üîç Ki·ªÉm tra xem c√≥ b·ªã ƒëi·ªÅn nh·∫ßm t√™n sinh vi√™n v√†o tr∆∞·ªùng ƒë·∫°i h·ªçc kh√¥ng...");
    
    const schoolInput = document.querySelector('input[placeholder*="T√™n ƒê·∫°i h·ªçc"], input[placeholder*="University"], input[placeholder*="College"]');
    if (schoolInput) {
        const schoolValue = schoolInput.value;
        console.log(\`üìù Gi√° tr·ªã hi·ªán t·∫°i trong tr∆∞·ªùng ƒë·∫°i h·ªçc: "\${schoolValue}"\`);
        
        // Ki·ªÉm tra xem c√≥ ch·ª©a t√™n sinh vi√™n kh√¥ng
        if (schoolValue.includes('${studentName}') || 
            schoolValue.includes('${firstName}') || 
            schoolValue.includes('${lastName}') ||
            schoolValue.includes('${studentName.toLowerCase()}') ||
            schoolValue.includes('${firstName.toLowerCase()}') ||
            schoolValue.includes('${lastName.toLowerCase()}')) {
            
            console.log("‚ö†Ô∏è Ph√°t hi·ªán t√™n sinh vi√™n b·ªã ƒëi·ªÅn nh·∫ßm v√†o tr∆∞·ªùng ƒë·∫°i h·ªçc!");
            console.log("üîÑ X√≥a v√† ƒë·ªÉ tr·ªëng tr∆∞·ªùng ƒë·∫°i h·ªçc...");
            
            // X√≥a n·ªôi dung
            schoolInput.value = '';
            schoolInput.dispatchEvent(new Event('input', { bubbles: true }));
            schoolInput.dispatchEvent(new Event('change', { bubbles: true }));
            schoolInput.dispatchEvent(new Event('blur', { bubbles: true }));
            
            await delay(500);
            console.log("‚úÖ ƒê√£ x√≥a t√™n sinh vi√™n kh·ªèi tr∆∞·ªùng ƒë·∫°i h·ªçc");
        } else {
            console.log("‚úÖ Tr∆∞·ªùng ƒë·∫°i h·ªçc kh√¥ng b·ªã ƒëi·ªÅn nh·∫ßm t√™n sinh vi√™n");
        }
    }
    
    // Ki·ªÉm tra v√† x·ª≠ l√Ω l·ªói
    await delay(1000);
    console.log("üîç Ki·ªÉm tra l·ªói form...");
    
    // Ki·ªÉm tra l·ªói network
    console.log("üåê Ki·ªÉm tra l·ªói network...");
    const networkErrors = [
        'ERR_BLOCKED_BY_CLIENT',
        'ERR_NETWORK_CHANGED',
        'ERR_INTERNET_DISCONNECTED',
        'ERR_CONNECTION_REFUSED',
        'ERR_NAME_NOT_RESOLVED'
    ];
    
    // Ki·ªÉm tra console errors
    const originalError = console.error;
    let hasNetworkErrors = false;
    console.error = function(...args) {
        const errorMessage = args.join(' ');
        if (networkErrors.some(error => errorMessage.includes(error))) {
            hasNetworkErrors = true;
            console.log(\`‚ö†Ô∏è Ph√°t hi·ªán l·ªói network: \${errorMessage}\`);
        }
        originalError.apply(console, args);
    };
    
    // T√¨m c√°c th√¥ng b√°o l·ªói form
    const errorSelectors = [
        '.error',
        '.invalid',
        '.required',
        '[class*="error"]',
        '[class*="invalid"]',
        '[class*="required"]',
        '.field-error',
        '.validation-error',
        '.alert-danger',
        '.text-danger'
    ];
    
    let hasFormErrors = false;
    for (const selector of errorSelectors) {
        const errors = document.querySelectorAll(selector);
        if (errors.length > 0) {
            console.log(\`‚ö†Ô∏è T√¨m th·∫•y \${errors.length} l·ªói form v·ªõi selector: \${selector}\`);
            errors.forEach((error, index) => {
                console.log(\`  L·ªói \${index + 1}: \${error.innerText || error.textContent}\`);
            });
            hasFormErrors = true;
        }
    }
    
    // X·ª≠ l√Ω l·ªói network
    if (hasNetworkErrors) {
        console.log("üåê Ph√°t hi·ªán l·ªói network, c√≥ th·ªÉ do:");
        console.log("   - Ad blocker ch·∫∑n request");
        console.log("   - Extension b·∫£o m·∫≠t ch·∫∑n");
        console.log("   - C√†i ƒë·∫∑t quy·ªÅn ri√™ng t∆∞");
        console.log("   - LaunchDarkly/SheerID b·ªã ch·∫∑n");
        console.log("‚ö†Ô∏è L∆∞u √Ω: L·ªói n√†y kh√¥ng ·∫£nh h∆∞·ªüng ƒë·∫øn vi·ªác ƒëi·ªÅn form");
    }
    
    // X·ª≠ l√Ω l·ªói form
    if (hasFormErrors) {
        console.log("‚ùå Form c√≥ l·ªói, th·ª≠ ƒëi·ªÅn l·∫°i...");
        
        // Th·ª≠ ƒëi·ªÅn l·∫°i c√°c tr∆∞·ªùng b·ªã l·ªói
        await delay(500);
        await fillPersonalInfo();
        
        // Ki·ªÉm tra l·∫°i
        await delay(1000);
        console.log("üîç Ki·ªÉm tra l·∫°i sau khi ƒëi·ªÅn l·∫°i...");
    }
    
    // Kh√¥i ph·ª•c console.error
    console.error = originalError;
    
    console.log("‚úÖ Form Google One ƒë√£ ƒë∆∞·ª£c ƒëi·ªÅn ƒë·∫ßy ƒë·ªß v·ªõi th√¥ng tin c·ªßa ${studentName} (ch∆∞a submit)");
    
    // Hi·ªÉn th·ªã th√¥ng b√°o v·ªÅ form ƒë√£ ƒë∆∞·ª£c ƒëi·ªÅn
    console.log("üéì Student verification form has been filled successfully!");
    console.log("üìã Information filled:");
    console.log("   üë§ Name: ${studentName}");
    console.log("   üìß Email: ${email} (no spaces, no special characters)");
    console.log("   üìÖ Birth date: 26/03/2006");
    console.log("   üåç Country: Not filled (skipped)");
    console.log("   üè´ University: Not filled (skipped)");
    console.log("   ‚úÖ Checked that student name is not mistakenly filled in university field");
    console.log("   ‚ö†Ô∏è Note: You need to submit the form manually!");
    console.log("");
    console.log("üîß Error handling guide:");
    console.log("   - If you see ERR_BLOCKED_BY_CLIENT error: Normal, no impact");
    console.log("   - If form cannot be filled: Check the fields again");
    console.log("   - If there are validation errors: Fill information manually");
    console.log("   - If still errors: Turn off ad blocker and try again");
    console.log("   - If student name is mistakenly filled: Script has automatically cleared and fixed");
})();`;

            // Copy script tr·ª±c ti·∫øp v√†o clipboard
            navigator.clipboard.writeText(script).then(() => {
                showCopySuccessPopup('Script form t·ª± ƒë·ªông', 'Script ƒë√£ ƒë∆∞·ª£c copy v√†o clipboard!');
            }).catch(() => {
                // Fallback cho tr√¨nh duy·ªát c≈©
                const textArea = document.createElement('textarea');
                textArea.value = script;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showCopySuccessPopup('Script form t·ª± ƒë·ªông', 'Script ƒë√£ ƒë∆∞·ª£c copy v√†o clipboard!');
            });
        }

        // Hi·ªÉn th·ªã popup th√¥ng b√°o copy th√†nh c√¥ng
        function showCopySuccessPopup(title, content) {
            const popupId = 'copySuccessPopup-' + Date.now();
            
            const popupHtml = `
                <div class="copy-success-popup" id="${popupId}">
                    <div class="copy-success-content">
                        <div class="copy-success-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="copy-success-text">
                            <h5>‚úÖ ${title} ƒë√£ ƒë∆∞·ª£c copy!</h5>
                            <p>${content}</p>
                        </div>
                        <button class="copy-success-close" onclick="closeCopySuccessPopup('${popupId}')">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `;
            
            // Th√™m CSS cho popup
            if (!document.getElementById('copySuccessPopupStyle')) {
                const style = document.createElement('style');
                style.id = 'copySuccessPopupStyle';
                style.textContent = `
                    .copy-success-popup {
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        z-index: 9999;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        border-radius: 15px;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                        padding: 20px;
                        max-width: 350px;
                        animation: slideInRight 0.5s ease-out;
                        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                    }
                    
                    .copy-success-content {
                        display: flex;
                        align-items: center;
                        gap: 15px;
                        position: relative;
                    }
                    
                    .copy-success-icon {
                        font-size: 24px;
                        color: #4CAF50;
                        animation: bounce 0.6s ease-out;
                    }
                    
                    .copy-success-text h5 {
                        margin: 0 0 5px 0;
                        font-size: 16px;
                        font-weight: 600;
                    }
                    
                    .copy-success-text p {
                        margin: 0;
                        font-size: 14px;
                        opacity: 0.9;
                        line-height: 1.4;
                    }
                    
                    .copy-success-close {
                        position: absolute;
                        top: -5px;
                        right: -5px;
                        background: rgba(255,255,255,0.2);
                        border: none;
                        color: white;
                        border-radius: 50%;
                        width: 25px;
                        height: 25px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        cursor: pointer;
                        font-size: 12px;
                        transition: all 0.3s ease;
                    }
                    
                    .copy-success-close:hover {
                        background: rgba(255,255,255,0.3);
                        transform: scale(1.1);
                    }
                    
                    @keyframes slideInRight {
                        from {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                        to {
                            transform: translateX(0);
                            opacity: 1;
                        }
                    }
                    
                    @keyframes bounce {
                        0%, 20%, 50%, 80%, 100% {
                            transform: translateY(0);
                        }
                        40% {
                            transform: translateY(-10px);
                        }
                        60% {
                            transform: translateY(-5px);
                        }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // Th√™m popup v√†o body
            document.body.insertAdjacentHTML('beforeend', popupHtml);
            
            // T·ª± ƒë·ªông ƒë√≥ng sau 4 gi√¢y
            setTimeout(() => {
                closeCopySuccessPopup(popupId);
            }, 4000);
        }
        
        // ƒê√≥ng popup copy success
        function closeCopySuccessPopup(popupId) {
            const popup = document.getElementById(popupId);
            if (popup) {
                popup.style.animation = 'slideInRight 0.3s ease-out reverse';
                setTimeout(() => {
                    popup.remove();
                }, 300);
            }
        }

        // Hi·ªÉn th·ªã th√¥ng b√°o
        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alertId = 'alert-' + Date.now();
            
            container.innerHTML = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert" id="${alertId}">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : type === 'danger' ? 'times-circle' : 'info-circle'} me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            // Auto dismiss after 5 seconds
            setTimeout(() => {
                const alert = document.getElementById(alertId);
                if (alert) {
                    alert.remove();
                }
            }, 5000);
        }

        // Kh·ªüi t·∫°o khi trang load
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
